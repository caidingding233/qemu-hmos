---
description: QEMU集成和虚拟机配置说明
---

# QEMU集成说明

## QEMU源码结构
- **源码位置**: [third_party/qemu/](mdc:entry/src/main/cpp/CMakeLists.txt) - 完整的QEMU源码
- **构建产物**: [third_party/qemu/build_harmonyos_full/](mdc:third_party/qemu/build_harmonyos_full/) - 构建输出目录
- **构建脚本**: [third_party/qemu/build_qemu_full_so.sh](mdc:third_party/qemu/build_qemu_full_so.sh) - 构建脚本

## 虚拟机配置
典型的QEMU启动参数（由应用生成）：
```bash
-machine virt,gic-version=3,virtualization=on
-cpu max -smp 4 -m 6144
-accel tcg,thread=multi,tb-size=128
-bios edk2-aarch64-code.fd
-drive if=none,id=d0,file=win11arm.qcow2,format=qcow2
-device nvme,drive=d0,serial=nvme0
-netdev user,id=n0,hostfwd=tcp:127.0.0.1:3390-:3389
-device virtio-net-pci,netdev=n0
```

## 网络配置
- **安装期**: 使用VNC显示 (`-display vnc=:1`)
- **日常使用**: RDP连接 `127.0.0.1:3390` (映射到虚拟机3389端口)
- **离线访问**: 通过hostfwd实现本地端口转发

## 性能优化
- **JIT支持**: 运行时探测KVM，可用时使用硬件加速
- **TCG降级**: 无KVM时自动使用TCG JIT
- **多线程**: 启用多线程TCG加速

## 固件管理
- **EFI固件**: 推荐使用edk2-aarch64-code.fd
- **存储位置**: [entry/src/main/resources/rawfile/](mdc:entry/src/main/resources/rawfile/)
- **自动检测**: 应用会自动检测固件可用性