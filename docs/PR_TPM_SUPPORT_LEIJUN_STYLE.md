## 这一次，我们把“鸿蒙 × QEMU 的 TPM”搬上了台面

### 我们请了3000名熟悉 QEMU 的老工程师，历时三天三夜的研发，把日志一行一行过；也拉着鸿蒙那一块同学开了几场会，把“为什么一加 TPM 参数就直接崩溃”这件事掰开揉碎。  
### 最后，答案很朴素：**QEMU 一旦不识别参数，会直接 `exit(1)`，在鸿蒙的 in-process 模式下就是“当场把 App 送走”。**

所以这次，我们做了两件“看起来简单、实际上非常关键”的事情：

- **让 QEMU 真正“认识” `-tpmdev`**：在构建脚本里显式开启 TPM（避免因为默认配置/裁剪导致 `-tpmdev: invalid option`）。
- **让鸿蒙环境也能“活着用” TPM**：在 QEMU 的 `tpm_emulator` 里增加 HarmonyOS 的内置最小 TPM2 兜底（无需 swtpm 外部进程），确保参数存在时不会引发进程级崩溃。

###### **小字**：
  1. **TPM 依然不受 Windows 完整支持**：当前是“最小可用”兜底，目标是先稳定启动链路，后续再补齐兼容性。
  2. **开关机依然需要强制杀后台**：这仍然是稳定性优先的临时策略。
  3. **创建向导选择的镜像**：打开虚拟机后可能提示 ISO 未加载进沙箱，你需要在设置页重新选择一次。
  4. **大写按钮暂时无法透传到 QEMU**：部分按键（例如 Caps/某些组合键）仍有输入链路缺口，后续修。

---

###### 提交对应（给 PR 用）

- **QEMU 构建脚本**：启用 TPM（`--enable-tpm` / `-Dtpm=enabled`）
- **QEMU 内置兜底**：HarmonyOS 下 `tpm_emulator` 无 chardev 走 minimal TPM2，避免 `exit(1)` 崩溃
- **启动参数**：恢复启动阶段的 `-tpmdev emulator,id=tpm0` + `tpm-tis-device`（virt/acpi 更稳）


