# ä¾èµ–åº“è¯´æ˜

## æ¦‚è¿°

QEMUéœ€è¦å¤šä¸ªç¬¬ä¸‰æ–¹åº“æ¥æä¾›å®Œæ•´åŠŸèƒ½ã€‚è¿™äº›åº“å·²ç»è¢«ç¼–è¯‘æˆé™æ€åº“ï¼ˆ`.a`æ–‡ä»¶ï¼‰ï¼Œå¹¶ä¸”ä¼šè¢«é“¾æ¥åˆ°æœ€ç»ˆçš„å…±äº«åº“ï¼ˆ`.so`æ–‡ä»¶ï¼‰ä¸­ã€‚

## ä¾èµ–åº“åˆ—è¡¨

### 1. GLibåº“ (GNU Library)
**ä½ç½®**: `third_party/deps/glib/`
**ç”¨é€”**: æä¾›åŸºç¡€æ•°æ®ç»“æ„ã€å†…å­˜ç®¡ç†ã€å­—ç¬¦ä¸²å¤„ç†ç­‰æ ¸å¿ƒåŠŸèƒ½

**åŒ…å«çš„é™æ€åº“**:
- `libglib-2.0.a` - æ ¸å¿ƒGLibåº“
- `libgobject-2.0.a` - å¯¹è±¡ç³»ç»Ÿ
- `libgthread-2.0.a` - çº¿ç¨‹æ”¯æŒ
- `libcharset.a` - å­—ç¬¦é›†å¤„ç†
- `libgnulib.a` - GNUåº“å‡½æ•°

### 2. Pixmanåº“
**ä½ç½®**: `third_party/deps/pixman/`
**ç”¨é€”**: æä¾›åƒç´ æ“ä½œå’Œå›¾åƒå¤„ç†åŠŸèƒ½ï¼ŒVNCæ˜¾ç¤ºå¿…éœ€

**åŒ…å«çš„é™æ€åº“**:
- `libpixman-1.a` - æ ¸å¿ƒPixmanåº“
- `libpixman-arm-neon.a` - ARM NEONä¼˜åŒ–

### 3. OpenSSLåº“
**ä½ç½®**: `third_party/deps/openssl/`
**ç”¨é€”**: æä¾›åŠ å¯†å’ŒSSL/TLSæ”¯æŒï¼Œç½‘ç»œåŠŸèƒ½å¿…éœ€

**åŒ…å«çš„é™æ€åº“**:
- `libssl.a` - SSL/TLSåè®®å®ç°
- `libcrypto.a` - åŠ å¯†ç®—æ³•åº“

### 4. PCRE2åº“
**ä½ç½®**: `third_party/deps/pcre2/`
**ç”¨é€”**: æä¾›æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒ

**åŒ…å«çš„é™æ€åº“**:
- `libpcre2-8.a` - 8ä½å­—ç¬¦æ­£åˆ™è¡¨è¾¾å¼
- `libpcre2-posix.a` - POSIXå…¼å®¹æ¥å£

## æ„å»ºè¿‡ç¨‹

### 1. ä¾èµ–åº“ç¼–è¯‘
è¿™äº›åº“å·²ç»åœ¨æœ¬åœ°ç¼–è¯‘å®Œæˆï¼Œç”Ÿæˆäº†é™æ€åº“æ–‡ä»¶ï¼š

```bash
# æ£€æŸ¥å·²ç¼–è¯‘çš„é™æ€åº“
find third_party/deps -name "*.a" | wc -l
# è¾“å‡º: 26 (å…±26ä¸ªé™æ€åº“æ–‡ä»¶)
```

### 2. é“¾æ¥åˆ°å…±äº«åº“
åœ¨åˆ›å»ºæœ€ç»ˆçš„`libqemu_full.so`æ—¶ï¼Œè¿™äº›é™æ€åº“ä¼šè¢«é“¾æ¥è¿›å»ï¼š

```bash
$CXX -shared -fPIC -Wl,--no-undefined \
  -target aarch64-unknown-linux-ohos --sysroot=${SYSROOT} \
  -Wl,--whole-archive \
  libqemu-aarch64-softmmu.a \
  libqemuutil.a \
  -Wl,--no-whole-archive \
  # ä¾èµ–åº“
  ../../deps/glib/build/glib/libglib-2.0.a \
  ../../deps/glib/build/gobject/libgobject-2.0.a \
  ../../deps/glib/build/gthread/libgthread-2.0.a \
  ../../deps/glib/build/glib/libcharset/libcharset.a \
  ../../deps/glib/build/glib/gnulib/libgnulib.a \
  ../../deps/pixman/build/pixman/libpixman-1.a \
  ../../deps/pixman/build/pixman/libpixman-arm-neon.a \
  ../../deps/openssl/build/libssl.a \
  ../../deps/openssl/build/libcrypto.a \
  ../../deps/pcre2/build/libpcre2-8.a \
  ../../deps/pcre2/build/libpcre2-posix.a \
  -lpthread -ldl -lm -lz \
  -o libqemu_full.so
```

## åŠŸèƒ½æ”¯æŒ

### 1. VNCæ˜¾ç¤ºåŠŸèƒ½
- **ä¾èµ–**: Pixmanåº“
- **åŠŸèƒ½**: åƒç´ æ“ä½œã€å›¾åƒå‹ç¼©ã€æ˜¾ç¤ºæ¸²æŸ“
- **æ”¯æŒ**: JPEG/PNGå‹ç¼©ã€SASLè®¤è¯

### 2. ç½‘ç»œåŠŸèƒ½
- **ä¾èµ–**: OpenSSLåº“
- **åŠŸèƒ½**: SSL/TLSåŠ å¯†ã€HTTPSä¸‹è½½
- **æ”¯æŒ**: å®‰å…¨ç½‘ç»œè¿æ¥ã€è¯ä¹¦éªŒè¯

### 3. ç³»ç»ŸåŠŸèƒ½
- **ä¾èµ–**: GLibåº“
- **åŠŸèƒ½**: å†…å­˜ç®¡ç†ã€å­—ç¬¦ä¸²å¤„ç†ã€æ•°æ®ç»“æ„
- **æ”¯æŒ**: çº¿ç¨‹ã€å¯¹è±¡ç³»ç»Ÿã€å­—ç¬¦é›†

### 4. æ–‡æœ¬å¤„ç†
- **ä¾èµ–**: PCRE2åº“
- **åŠŸèƒ½**: æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
- **æ”¯æŒ**: é…ç½®è§£æã€æ–‡æœ¬æœç´¢

## å­æ¨¡å—çŠ¶æ€

### ä¹‹å‰çš„é—®é¢˜
è¿™äº›ç›®å½•ä¹‹å‰è¢«Gitè¯†åˆ«ä¸ºå­æ¨¡å—ï¼Œä½†`.gitmodules`æ–‡ä»¶ä¸­æ²¡æœ‰å¯¹åº”é…ç½®ï¼Œå¯¼è‡´æ„å»ºå¤±è´¥ï¼š

```
fatal: No url found for submodule path 'third_party/deps/glib/src' in .gitmodules
```

### è§£å†³æ–¹æ¡ˆ
1. **ç§»é™¤å­æ¨¡å—é…ç½®**: ä½¿ç”¨`git rm --cached`ç§»é™¤Gitè·Ÿè¸ª
2. **ä¿ç•™æºä»£ç **: æºä»£ç å’Œç¼–è¯‘äº§ç‰©ä»ç„¶å­˜åœ¨
3. **ç§»é™¤.gitç›®å½•**: åˆ é™¤åµŒå…¥çš„Gitä»“åº“ï¼Œä½¿å…¶æˆä¸ºæ™®é€šç›®å½•

### å½“å‰çŠ¶æ€
- âœ… **æºä»£ç å­˜åœ¨**: æ‰€æœ‰ä¾èµ–åº“çš„æºä»£ç éƒ½åœ¨
- âœ… **é™æ€åº“å­˜åœ¨**: å·²ç¼–è¯‘çš„`.a`æ–‡ä»¶éƒ½åœ¨
- âœ… **GitçŠ¶æ€æ­£å¸¸**: ä¸å†æœ‰å­æ¨¡å—å†²çª
- âœ… **æ„å»ºå°±ç»ª**: å¯ä»¥æ­£å¸¸é“¾æ¥åˆ°å…±äº«åº“

## éªŒè¯æ–¹æ³•

### 1. æ£€æŸ¥é™æ€åº“
```bash
# æŸ¥çœ‹æ‰€æœ‰é™æ€åº“
find third_party/deps -name "*.a"

# æ£€æŸ¥åº“æ–‡ä»¶å¤§å°
du -h third_party/deps/*/build/*/*.a | head -10
```

### 2. æ£€æŸ¥é“¾æ¥
```bash
# æ„å»ºåæ£€æŸ¥å…±äº«åº“
file libqemu_full.so
ldd libqemu_full.so  # æŸ¥çœ‹åŠ¨æ€ä¾èµ–
```

### 3. åŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•VNCåŠŸèƒ½
qemu-system-aarch64 -vnc :0 -monitor stdio

# æµ‹è¯•ç½‘ç»œåŠŸèƒ½
qemu-system-aarch64 -netdev user,id=net0 -device virtio-net-pci,netdev=net0
```

## æ€»ç»“

**æ˜¯çš„ï¼Œè¿™äº›ä¾èµ–åº“ä¼šè¢«ç¼–è¯‘æˆsoæ–‡ä»¶ï¼**

1. **é™æ€åº“å­˜åœ¨**: 26ä¸ª`.a`æ–‡ä»¶å·²ç»ç¼–è¯‘å®Œæˆ
2. **ä¼šè¢«é“¾æ¥**: åœ¨åˆ›å»º`libqemu_full.so`æ—¶ä¼šè¢«é“¾æ¥è¿›å»
3. **åŠŸèƒ½å®Œæ•´**: æ”¯æŒVNCã€ç½‘ç»œã€åŠ å¯†ç­‰æ‰€æœ‰åŠŸèƒ½
4. **å­æ¨¡å—é—®é¢˜å·²è§£å†³**: ä¸å†æœ‰Gité…ç½®å†²çª

æœ€ç»ˆçš„`libqemu_full.so`å°†åŒ…å«ï¼š
- QEMUæ ¸å¿ƒåŠŸèƒ½
- GLibç³»ç»Ÿåº“
- Pixmanå›¾åƒå¤„ç†
- OpenSSLåŠ å¯†
- PCRE2æ­£åˆ™è¡¨è¾¾å¼

è¿™æ ·æ„å»ºçš„å…±äº«åº“æ˜¯è‡ªåŒ…å«çš„ï¼Œä¸éœ€è¦é¢å¤–çš„ç³»ç»Ÿä¾èµ–ï¼ğŸ‰
